# 모바일 청첩장 플랫폼 기획서 (v1)

## 1. 목표
기존 단일 청첩장 제작 방식을 플랫폼화하여, 사용자가 로그인 후 자신의 청첩장을 직접 생성/수정/미리보기/내보내기 할 수 있는 SaaS 형태로 전환한다.

## 2. 핵심 사용자 흐름
1. 사용자는 로그인/회원가입 화면에서 Google 로그인으로 가입 또는 로그인한다.
2. 로그인 즉시 청첩장 관리자 화면으로 진입한다.
3. 최초 진입 시 모든 입력값은 빈칸이며, 청첩장 출력도 빈 양식으로 보인다.
4. 사진 영역은 실제 이미지 대신 회색 박스(placeholder)로 표시된다.
5. 사용자는 관리자 기능으로 모든 값을 입력/수정한다.
6. 사용자는 `청첩장 미리보기`로 비공유용 미리보기 링크를 확인한다.
7. 사용자는 `청첩장 내보내기`로 실제 공유 가능한 링크를 생성한다.
8. 내보내기 이후에도 계속 수정 가능하다.

## 3. 기능 요구사항
### 3.1 인증
- 로그인 방식: Google OAuth 로그인만 지원
- 회원가입/로그인 통합: 최초 로그인 시 자동 회원 생성
- 로그인 성공 시 관리자 전체 화면 노출

### 3.2 관리자 초기 상태
- 신규 사용자(또는 신규 청첩장) 생성 시 템플릿은 구조만 제공
- 텍스트 입력값 기본값: 빈 문자열
- 이미지/비디오 기본값: 없음
- 미리보기 화면에서 이미지 미입력 영역은 회색 박스 노출

### 3.3 관리자 편집
- 현재 관리자의 모든 편집 기능 유지
- 입력/수정/삭제/순서변경/업로드 가능
- 저장은 `초안(Draft)` 상태에 반영

### 3.4 청첩장 미리보기
- 관리자의 `청첩장 미리보기` 버튼으로 미리보기 링크 생성
- 미리보기 링크는 비공유 목적
- 접근 정책:
  - 로그인 사용자 본인만 접근 가능
  - 외부 공유 불가(토큰 단기 만료 + 소유자 검증)

### 3.5 청첩장 내보내기
- `청첩장 내보내기` 실행 시 공유 가능한 `공개 링크(Published URL)` 생성
- 공개 링크는 누구나 접근 가능
- 내보내기 후에도 편집 가능
- 편집 후 재내보내기 시 공개 링크는 유지하고 콘텐츠 버전만 업데이트

## 4. 화면/라우트 제안
- `/auth/login`: Google 로그인 화면
- `/dashboard`: 사용자 청첩장 목록 (v1에서는 1개만 허용 가능)
- `/dashboard/invitation/:id/admin`: 관리자 편집 화면
- `/preview/:previewToken`: 비공유 미리보기 화면
- `/invite/:publicSlug`: 공개 청첩장 화면

## 5. 데이터 모델 (v1)
- `users`
  - `id`, `email`, `name`, `provider=google`, `createdAt`
- `invitations`
  - `id`, `userId`, `title`, `status(draft|published)`, `publicSlug`, `publishedAt`, `updatedAt`
- `invitation_contents`
  - `invitationId`, `contentJson`, `version`, `updatedAt`
- `preview_tokens`
  - `token`, `invitationId`, `userId`, `expiresAt`, `usedAt(optional)`

## 6. 상태 정책
- `Draft`: 내부 편집 상태
- `Published`: 공개 링크 활성 상태
- Draft 저장은 즉시 반영(관리자/미리보기 기준)
- Published는 `내보내기` 시점 버전 기준으로 배포

## 7. 링크 정책
### 7.1 미리보기 링크
- 목적: 편집자 본인 확인
- 공유 불가 원칙:
  - 단기 만료(예: 10~30분)
  - 로그인 사용자 + 소유자 검증
  - 검색엔진 비노출

### 7.2 공개 링크
- 목적: 실제 하객 공유
- 고정 URL 사용(예: `/invite/{publicSlug}`)
- 내보내기 이후 재수정 가능하며 재내보내기로 최신본 반영

## 8. 권한 정책
- 초안/관리 데이터: 소유자만 읽기/쓰기
- 미리보기: 소유자만 접근
- 공개 청첩장: 인증 없이 읽기 가능

## 9. 비기능 요구사항
- 모바일 우선 반응형 유지
- 저장 신뢰성: 저장 실패 시 명확한 오류 표시
- 업로드 보안: 확장자/MIME/용량 제한 유지
- 백업/복구 정책 유지(운영자 기능)

## 10. 단계별 구현 계획
1. 인증 기반 전환
- Google OAuth 도입
- 사용자/세션 모델 적용

2. 데이터 멀티테넌시 전환
- 파일(JSON) 기반에서 DB 기반으로 전환
- 사용자별 invitation 분리

3. 미리보기/내보내기 분리
- preview token, public slug 발급 로직 추가
- 접근 권한 정책 적용

4. 관리자 UX 고도화
- 빈 템플릿/placeholder 통일
- 저장/내보내기 상태 표시

5. 배포/운영
- 프로덕션 환경변수/보안 설정
- 모니터링/에러 로깅 적용

## 11. 수용 기준 (Acceptance Criteria)
1. Google 로그인 성공 시 관리자 화면 진입 가능
2. 신규 청첩장은 모든 텍스트가 빈칸이고 이미지는 회색 박스로 보임
3. 미리보기 링크는 본인만 접근 가능하고 외부 공유로는 접근 불가
4. 내보내기 시 공개 링크가 생성되고 외부 접근 가능
5. 내보내기 이후에도 수정 가능하며 재내보내기로 최신 반영 가능

## 12. 서버/인프라 요구사항
- 실제 서비스 운영을 위해 서버(백엔드)와 DB가 필수이다.
- 이유:
  - 로그인 세션 관리
  - 사용자별 청첩장 데이터 저장
  - 고유 링크 생성/중복 방지
  - 미리보기 링크 권한 검증

### 12.1 권장 구성
- App Server: Next.js(App Router) + API Route 또는 별도 Node 서버
- DB: PostgreSQL(권장), 또는 동급 관계형 DB
- Object Storage: 이미지/비디오 파일 저장(S3 호환)
- Cache: Redis(선택, 미리보기 토큰/세션 최적화)

### 12.2 배포 구성
- 도메인: `MarieCard.io`
- 공개 청첩장 라우트: `MarieCard.io/invitation/{publicId}`
- 관리자 라우트: `MarieCard.io/dashboard/invitation/{id}/admin`
- 미리보기 라우트: `MarieCard.io/preview/{token}`

## 13. 고유 링크(publicId) 정책
- 사용자 공유 링크는 숫자형 고유 ID를 사용한다.
- 예시: `MarieCard.io/invitation/14934929`

### 13.1 생성 규칙 (v1)
- `publicId`: 8자리 숫자 랜덤 생성
- DB unique 인덱스로 중복 방지
- 중복 발생 시 재생성

### 13.2 공개 링크 라이프사이클
- 최초 `청첩장 내보내기` 시 `publicId` 발급
- 이후 재내보내기에서는 같은 `publicId` 유지
- 공개 중단 기능 필요 시 `status=archived`로 접근 차단

### 13.3 보안/운영 고려
- `publicId`는 URL 식별자이며 비밀번호가 아니다.
- 관리자 수정 권한은 항상 사용자 인증/소유권 검증으로 통제한다.
- 미리보기 토큰은 공개 링크와 분리하여 짧은 만료시간을 적용한다.
